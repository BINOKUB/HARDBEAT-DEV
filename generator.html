<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>HARDBEAT GENERATOR V3 (HUMAN MODE)</title>
    <style>
        :root { --bg: #0d0d0d; --panel: #1a1a1a; --cyan: #00f3ff; --purple: #a855f7; --text: #ccc; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', monospace; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: var(--panel); padding: 30px; border: 1px solid #333; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        h1 { color: var(--cyan); text-align: center; border-bottom: 1px solid #333; padding-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; }
        h2 { color: #fff; background: #333; padding: 8px 15px; margin-top: 30px; border-left: 5px solid #555; font-size: 14px; }
        .row { display: flex; gap: 15px; margin-bottom: 15px; }
        .col { flex: 1; }
        label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
        input[type="text"], input[type="number"] { width: 100%; background: #050505; border: 1px solid #444; color: #fff; padding: 8px; box-sizing: border-box; font-family: monospace; font-size: 13px; }
        input:focus { border-color: var(--cyan); outline: none; }
        textarea { width: 100%; height: 250px; background: #050505; color: #0f0; border: 1px solid #333; padding: 15px; margin-top: 20px; font-family: monospace; }
        button { width: 100%; padding: 15px; background: var(--cyan); border: none; font-weight: bold; cursor: pointer; margin-top: 30px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; transition: 0.2s; }
        button:hover { background: #fff; box-shadow: 0 0 15px var(--cyan); }
        
        .measure-box { border: 1px solid #333; padding: 15px; background: #111; }
        .measure-title { font-size: 12px; font-weight: bold; color: var(--cyan); margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .purple .measure-title { color: var(--purple); }
        
        .helper { font-size: 11px; color: #aaa; margin-bottom: 20px; background: #222; padding: 10px; border-left: 3px solid var(--cyan); }
    </style>
</head>
<body>

<div class="container">
    <h1>Generator V3 | Human Mode (1-64)</h1>
    
    <div class="row">
        <div class="col"><label>ID (ex: my_track)</label><input type="text" id="p-id" value="new_track_01"></div>
        <div class="col"><label>Nom Affiché</label><input type="text" id="p-name" value="MY TECHNO TRACK"></div>
        <div class="col"><label>BPM</label><input type="number" id="p-bpm" value="138"></div>
    </div>

    <h2 style="border-color: #fff">DRUMS (Comptez de 1 à 16)</h2>
    <div class="row">
        <div class="col"><label>KICK (ex: 1, 5, 9, 13)</label><input type="text" id="d-0" value="1, 5, 9, 13"></div>
        <div class="col"><label>SNARE (ex: 5, 13)</label><input type="text" id="d-1" value="5, 13"></div>
        <div class="col"><label>HHC (ex: 3, 7, 11, 15)</label><input type="text" id="d-2" value="3, 7, 11, 15"></div>
        <div class="col"><label>HHO</label><input type="text" id="d-3" value=""></div>
        <div class="col"><label>FM</label><input type="text" id="d-4" value=""></div>
    </div>

    <h2 style="border-color: var(--cyan)">SYNTH 2 (CYAN)</h2>
    <p class="helper">
        <strong>Mode Humain Activé :</strong> Ne calculez plus les zéros !<br>
        Mesure 1 = Pas 1 à 16 <br>
        Mesure 2 = Pas 17 à 32 <br>
        Mesure 3 = Pas 33 à 48 <br>
        Mesure 4 = Pas 49 à 64
    </p>
    
    <div class="row">
        <div class="col measure-box">
            <div class="measure-title">MESURE 1 (1 - 16)</div>
            <label>STEPS (ex: 1, 11)</label><input type="text" id="s2-m1-seq" value="1, 11, 14, 16">
            <label>FREQS (Hz)</label><input type="text" id="s2-m1-frq" value="313, 262, 350, 316">
        </div>
        <div class="col measure-box">
            <div class="measure-title">MESURE 2 (17 - 32)</div>
            <label>STEPS (ex: 17, 20)</label><input type="text" id="s2-m2-seq" value="17">
            <label>FREQS</label><input type="text" id="s2-m2-frq" value="313">
        </div>
        <div class="col measure-box">
            <div class="measure-title">MESURE 3 (33 - 48)</div>
            <label>STEPS</label><input type="text" id="s2-m3-seq" placeholder="">
            <label>FREQS</label><input type="text" id="s2-m3-frq" placeholder="">
        </div>
        <div class="col measure-box">
            <div class="measure-title">MESURE 4 (49 - 64)</div>
            <label>STEPS</label><input type="text" id="s2-m4-seq" placeholder="">
            <label>FREQS</label><input type="text" id="s2-m4-frq" placeholder="">
        </div>
    </div>

    <h2 style="border-color: var(--purple)">SYNTH 3 (VIOLET)</h2>
    
    <div class="row purple">
        <div class="col measure-box">
            <div class="measure-title">MESURE 1 (1 - 16)</div>
            <label>STEPS</label><input type="text" id="s3-m1-seq" placeholder="">
            <label>FREQS</label><input type="text" id="s3-m1-frq" placeholder="">
        </div>
        <div class="col measure-box">
            <div class="measure-title">MESURE 2 (17 - 32)</div>
            <label>STEPS</label><input type="text" id="s3-m2-seq" placeholder="">
            <label>FREQS</label><input type="text" id="s3-m2-frq" placeholder="">
        </div>
        <div class="col measure-box">
            <div class="measure-title">MESURE 3 (33 - 48)</div>
            <label>STEPS</label><input type="text" id="s3-m3-seq" placeholder="">
            <label>FREQS</label><input type="text" id="s3-m3-frq" placeholder="">
        </div>
        <div class="col measure-box">
            <div class="measure-title">MESURE 4 (49 - 64)</div>
            <label>STEPS (ex: 61, 62, 63)</label><input type="text" id="s3-m4-seq" value="61, 62, 63">
            <label>FREQS</label><input type="text" id="s3-m4-frq" value="208, 360, 310">
        </div>
    </div>

    <button onclick="generate()">GÉNÉRER LE CODE JS</button>
    <textarea id="output" readonly onclick="this.select()"></textarea>
</div>

<script>
    // Convertit "1, 5, 9" en [0, 4, 8] (Humain vers Machine)
    function parseInputHuman(str) {
        if(!str.trim()) return [];
        return str.split(',')
                  .map(x => parseFloat(x.trim()))
                  .filter(x => !isNaN(x))
                  .map(x => x - 1) // LE CÉLÈBRE -1 !
                  .filter(x => x >= 0 && x < 64); // Sécurité
    }

    // Convertit juste les fréquences (pas de -1 ici)
    function parseFreqs(str) {
        if(!str.trim()) return [];
        return str.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
    }

    function buildSynthTrack(prefix) {
        let fullSeq = [];
        let fullFreqs = new Array(64).fill(440); // 440 par défaut

        for(let m=0; m<4; m++) {
            // Ici on n'a plus besoin d'offset car l'utilisateur tape "17" qui devient "16" direct
            let steps = parseInputHuman(document.getElementById(`${prefix}-m${m+1}-seq`).value);
            let freqs = parseFreqs(document.getElementById(`${prefix}-m${m+1}-frq`).value);

            steps.forEach((machineIndex, i) => {
                // On ajoute le pas machine (ex: 16)
                fullSeq.push(machineIndex);

                // On met la fréquence au bon endroit
                if(freqs[i]) {
                    fullFreqs[machineIndex] = freqs[i];
                }
            });
        }
        return { seq: fullSeq, freqs: fullFreqs };
    }

    function generate() {
        const id = document.getElementById('p-id').value || "my_preset";
        const name = document.getElementById('p-name').value || "MY PRESET";
        const bpm = document.getElementById('p-bpm').value;

        // Drums (Humain vers Machine)
        const d0 = parseInputHuman(document.getElementById('d-0').value).join(', ');
        const d1 = parseInputHuman(document.getElementById('d-1').value).join(', ');
        const d2 = parseInputHuman(document.getElementById('d-2').value).join(', ');
        const d3 = parseInputHuman(document.getElementById('d-3').value).join(', ');
        const d4 = parseInputHuman(document.getElementById('d-4').value).join(', ');

        // Synths Logic
        const s2 = buildSynthTrack('s2');
        const s3 = buildSynthTrack('s3');

        const code = `
    "${id}": {
        name: "${name}",
        masterLength: 64,
        bpm: ${bpm},
        swing: 0,
        trackLengths: [16, 16, 16, 16, 16],
        drums: {
            seq: [
                makeSeq([${d0}]),
                makeSeq([${d1}]),
                makeSeq([${d2}]),
                makeSeq([${d3}]),
                makeSeq([${d4}])
            ],
            accents: [makeSeq([]), makeSeq([]), makeSeq([]), makeSeq([]), makeSeq([])]
        },
        synths: {
            seq2: makeSeq([${s2.seq.join(', ')}]),
            seq3: makeSeq([${s3.seq.join(', ')}])
        },
        freqs2: [${s2.freqs.join(', ')}],
        freqs3: [${s3.freqs.join(', ')}]
    },`;

        document.getElementById('output').value = code;
    }
</script>

</body>
</html>
